!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("axios"),require("vue"),require("clone"),require("debounce")):"function"==typeof define&&define.amd?define(["axios","vue","clone","debounce"],e):"object"==typeof exports?exports.dm5=e(require("axios"),require("vue"),require("clone"),require("debounce")):t.dm5=e(t.axios,t.vue,t.clone,t.debounce)}(window,function(t,e,i,n){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=4)}([function(e,i){e.exports=t},function(t,i){t.exports=e},function(t,e){t.exports=i},function(t,e){t.exports=n},function(t,e,i){"use strict";i.r(e);var n=i(0),o=i.n(n),r=i(2),c=i.n(r),s=i(3),a=i.n(s);function u(t){return Array.isArray(t)?t.map(function(t){return new N(t)}):new N(t)}function p(t,e){var i={};return t.forEach(function(t){return i[t[e]]=t}),i}var f=["+","-","&&","||","!","(",")","{","}","[","]","^",'"',"~","*","?",":","\\","AND","OR","NOT"];var l={instantiateMany:function(t,e){return t.map(function(t){return new e(t)})},instantiateChildren:function(t){var e={};for(var i in t)e[i]=u(t[i]);return e},clone:function(t){return c()(t)},debounce:function(t,e,i){return a()(t,e,i)},mapById:function(t){return p(t,"id")},mapByUri:function(t){return p(t,"uri")},mapByTypeUri:function(t){return p(t,"typeUri")},forEach:function(t,e){for(var i in t)e(t[i])},filter:function(t,e){var i={};for(var n in t){var o=t[n];e(o)&&(i[n]=o)}return i},isEmpty:function(t){return!Object.keys(t).length},getCookie:function(t){var e=document.cookie.match(new RegExp("\\b"+t+"=(\\w*)"));return e&&e[1]},setCookie:function(t,e){document.cookie=t+"="+e+";path=/"},fulltextQuery:function(t,e){var i=t.trim();return function(t){return f.some(function(e){return t.includes(e)})}(t)||(i=i.split(/ +/).join(" AND "),t.endsWith(" ")||(1!==i.length||e?i&&(i+="*"):i="")),i}},y=o.a.create(),d={getTopic:function(t,e,i){return o.a.get("/core/topic/"+t,{params:{children:e,assoc_children:i}}).then(function(t){return new N(t.data)})},getTopicByUri:function(t,e,i){return o.a.get("/core/topic/by_uri/"+t,{params:{children:e,assoc_children:i}}).then(function(t){return new N(t.data)})},getTopicsByType:function(t){return o.a.get("/core/topic/by_type/"+t).then(function(t){return l.instantiateMany(t.data,N)})},getTopicRelatedTopics:function(t,e){return o.a.get("/core/topic/"+t+"/related_topics",{params:g(e)}).then(function(t){return l.instantiateMany(t.data,J)})},queryTopicsFulltext:function(t,e){return y.get("/core/topic",{params:{query:t,type_uri:e}}).then(function(t){return{query:t.data.query,topics:l.instantiateMany(t.data.topics,N)}})},createTopic:function(t){return o.a.post("/core/topic",t).then(function(t){var e=new N(t.data);return e.directives=t.data.directives,e})},updateTopic:function(t){return o.a.put("/core/topic/"+t.id,t).then(function(t){return t.data})},deleteTopic:function(t){return o.a.delete("/core/topic/"+t).then(function(t){return t.data})},getAssoc:function(t,e,i){return o.a.get("/core/association/"+t,{params:{children:e,assoc_children:i}}).then(function(t){return new q(t.data)})},getAssocRelatedTopics:function(t,e){return o.a.get("/core/association/"+t+"/related_topics",{params:g(e)}).then(function(t){return l.instantiateMany(t.data,J)})},createAssoc:function(t){return o.a.post("/core/association",t).then(function(t){var e=new q(t.data);return e.directives=t.data.directives,e})},updateAssoc:function(t){return o.a.put("/core/association/"+t.id,t).then(function(t){return t.data})},deleteAssoc:function(t){return o.a.delete("/core/association/"+t).then(function(t){return t.data})},getRelatedTopicsWithoutChilds:function(t){return o.a.get("/core/object/"+t+"/related_topics").then(function(t){return l.instantiateMany(t.data,J)})},deleteMulti:function(t){return o.a.delete("/core"+h(t)).then(function(t){return t.data})},getAllTopicTypes:function(){return o.a.get("/core/topictype/all").then(function(t){return l.instantiateMany(t.data,z)})},createTopicType:function(t){return o.a.post("/core/topictype",t).then(function(t){return new z(t.data)})},updateTopicType:function(t){return o.a.put("/core/topictype",t).then(function(t){return t.data})},getAllAssocTypes:function(){return o.a.get("/core/assoctype/all").then(function(t){return l.instantiateMany(t.data,F)})},createAssocType:function(t){return o.a.post("/core/assoctype",t).then(function(t){return new F(t.data)})},updateAssocType:function(t){return o.a.put("/core/assoctype",t).then(function(t){return t.data})},createRoleType:function(t){return o.a.post("/core/roletype",t).then(function(t){return new N(t.data)})},getPlugins:function(){return o.a.get("/core/plugin").then(function(t){return t.data})},getWebsocketConfig:function(){return o.a.get("/core/websockets").then(function(t){return t.data})},createTopicmap:function(t,e,i){return o.a.post("/topicmap",i,{params:{name:t,topicmap_type_uri:e}}).then(function(t){return new N(t.data)})},getTopicmap:function(t){return o.a.get("/topicmap/"+t).then(function(t){return new H(t.data)})},getTopicmapTopics:function(t){return o.a.get("/topicmap/object/"+t).then(function(t){return l.instantiateMany(t.data,J)})},addTopicToTopicmap:function(t,e,i){v(i,"dmx.topicmaps.x","dmx.topicmaps.y"),o.a.post("/topicmap/"+t+"/topic/"+e,i)},addAssocToTopicmap:function(t,e,i){o.a.post("/topicmap/"+t+"/association/"+e,i)},addRelatedTopicToTopicmap:function(t,e,i,n){n?v(n,"dmx.topicmaps.x","dmx.topicmaps.y"):n={},o.a.post("/topicmap/"+t+"/topic/"+e+"/association/"+i,n)},setTopicViewProps:function(t,e,i){o.a.put("/topicmap/"+t+"/topic/"+e,i)},setAssocViewProps:function(t,e,i){o.a.put("/topicmap/"+t+"/association/"+e,i)},setTopicPosition:function(t,e,i){v(i,"x","y"),o.a.put("/topicmap/"+t+"/topic/"+e+"/"+i.x+"/"+i.y)},setTopicPositions:function(t,e){v(e,"x","y"),o.a.put("/topicmap/"+t,{topicCoords:e})},setTopicVisibility:function(t,e,i){o.a.put("/topicmap/"+t+"/topic/"+e+"/"+i)},hideMulti:function(t,e){o.a.put("/topicmap/"+t+h(e)+"/visibility/false")},setTopicmapViewport:l.debounce(function(t,e,i){v(e,"x","y"),o.a.put("/topicmap/"+t+"/pan/"+e.x+"/"+e.y+"/zoom/"+i)},3e3),getGeomap:function(t){return o.a.get("/geomap/"+t).then(function(t){return new Z(t.data)})},getDomainTopics:function(t,e,i){return o.a.get("/geomap/coord/"+t,{params:{children:e,assoc_children:i}}).then(function(t){return l.instantiateMany(t.data,N)})},setGeomapState:l.debounce(function(t,e,i,n){console.log("setGeomapState",e,i,n),o.a.put("/geomap/"+t+"/center/"+e+"/"+i+"/zoom/"+n)},3e3),createWorkspace:function(t,e,i){return o.a.post("/workspace",void 0,{params:{name:t,uri:e,sharing_mode_uri:i}}).then(function(t){return t.data})},getAssignedTopics:function(t,e,i,n){return o.a.get("/workspace/"+t+"/topics/"+e,{params:{children:i,assoc_children:n}}).then(function(t){return l.instantiateMany(t.data,N)})},getAssignedWorkspace:function(t){return o.a.get("/workspace/object/"+t).then(function(t){return t.data&&new N(t.data)})},login:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Basic";return y.post("/accesscontrol/login",void 0,{headers:{Authorization:e+" "+btoa(t.username+":"+t.password)}})},logout:function(){return o.a.post("/accesscontrol/logout")},getUsername:function(){return o.a.get("/accesscontrol/user").then(function(t){return t.data})},getTopicPermissions:function(t){return o.a.get("/accesscontrol/topic/"+t).then(function(t){return t.data})},getAssocPermissions:function(t){return o.a.get("/accesscontrol/association/"+t).then(function(t){return t.data})},getCreator:function(t){return o.a.get("/accesscontrol/object/"+t+"/creator").then(function(t){return t.data})},getModifier:function(t){return o.a.get("/accesscontrol/object/"+t+"/modifier").then(function(t){return t.data})},getWorkspaceOwner:function(t){return o.a.get("/accesscontrol/workspace/"+t+"/owner").then(function(t){return t.data})},getAuthorizationMethods:function(){return o.a.get("/accesscontrol/methods").then(function(t){return t.data})},createUserAccount:function(t,e){return o.a.post("/accesscontrol/user_account",{username:t,password:e}).then(function(t){return new N(t.data)})},getCreationTime:function(t){return o.a.get("/timestamps/object/"+t+"/created").then(function(t){return t.data})},getModificationTime:function(t){return o.a.get("/timestamps/object/"+t+"/modified").then(function(t){return t.data})},getXML:function(t){return o.a.get(t).then(function(t){return t.request.responseXML.documentElement})},setErrorHandler:function(t){o.a.interceptors.response.use(function(t){return t},function(e){return t(e),Promise.reject(e)})}};function h(t){var e="";return t.topicIds.length&&(e+="/topics/"+t.topicIds),t.assocIds.length&&(e+="/assocs/"+t.assocIds),e}function g(t){return t&&{assoc_type_uri:t.assocTypeUri,my_role_type_uri:t.myRoleTypeUri,others_role_type_uri:t.othersRoleTypeUri,others_topic_type_uri:t.othersTopicTypeUri}}function v(t,e,i){Array.isArray(t)?t.forEach(function(t){return m(t,e,i)}):m(t,e,i)}function m(t,e,i){t[e]=Math.round(t[e]),t[i]=Math.round(t[i])}var T=i(1),w=i.n(T),_={topicTypes:void 0,assocTypes:void 0,dataTypes:void 0,roleTypes:void 0},k={putTopicType:function(t,e){P(e)},putAssocType:function(t,e){U(e)},putRoleType:function(t,e){O(e)},_newTopicType:function(t,e){x(e.topicType)},_newAssocType:function(t,e){A(e.assocType)},_newRoleType:function(t,e){!function(t){O(new N(t))}(e.roleType)},_processDirectives:function(t,e){e.forEach(function(t){switch(t.type){case"UPDATE_TOPIC_TYPE":x(t.arg);break;case"UPDATE_ASSOCIATION_TYPE":A(t.arg)}}),w.a.nextTick(function(){e.forEach(function(t){switch(t.type){case"DELETE_TOPIC_TYPE":e=t.arg.uri,w.a.delete(_.topicTypes,e);break;case"DELETE_ASSOCIATION_TYPE":!function(t){w.a.delete(_.assocTypes,t)}(t.arg.uri);break;case"DELETE_TOPIC":"dmx.core.role_type"===t.arg.typeUri&&function(t){w.a.delete(_.roleTypes,t)}(t.arg.uri)}var e})})}};function b(t,e,i){var n=_[i]&&_[i][t];if(!n)throw Error(e+' "'+t+'" not in type cache');return n}function x(t){P(new z(t))}function A(t){U(new F(t))}function P(t){E(t,z,"topicTypes")}function U(t){E(t,F,"assocTypes")}function O(t){E(t,N,"roleTypes")}function E(t,e,i){if(!(t instanceof e))throw Error("can't cache \""+t.constructor.name+'", expected is "'+e.name+'", '+JSON.stringify(t));w.a.set(_[i],t.uri,t)}var C={init:function(t){return t.registerModule("typeCache",{state:_,actions:k}),Promise.all([d.getAllTopicTypes().then(function(t){_.topicTypes=l.mapByUri(t),P(new z({uri:"dmx.core.meta_meta_type",typeUri:"dmx.core.meta_meta_meta_type",value:"Meta Meta Type",dataTypeUri:"dmx.core.text",compDefs:[],viewConfigTopics:[]}))}),d.getAllAssocTypes().then(function(t){_.assocTypes=l.mapByUri(t)}),d.getTopicsByType("dmx.core.data_type").then(function(t){_.dataTypes=l.mapByUri(t)}),d.getTopicsByType("dmx.core.role_type").then(function(t){_.roleTypes=l.mapByUri(t)})]).then(function(){})},getTopicType:function(t){return b(t,"topic type","topicTypes")},getAssocType:function(t){return b(t,"assoc type","assocTypes")},getDataType:function(t){return b(t,"data type","dataTypes")},getRoleType:function(t){return b(t,"role type","roleTypes")},getTypeById:function(t){var e=Object.values(_.topicTypes).concat(Object.values(_.assocTypes)).filter(function(e){return e.id===t});if(1!==e.length)throw Error(e.length+" types with ID "+t+" in type cache");return e[0]}},I={isTopicWritable:function(t){return M(t,d.getTopicPermissions)},isAssocWritable:function(t){return M(t,d.getAssocPermissions)},clear:function(){j={}}},j={};function M(t,e){return(j[t]||(j[t]=e(t))).then(function(t){return t["dmx.accesscontrol.operation.write"]})}var D=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},V=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();function R(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function S(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function W(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var B=function(){function t(e){if(W(this,t),!e)throw Error("invalid object passed to DMXObject constructor: "+e);if("Object"!==e.constructor.name)throw Error("DMXObject constructor expects plain Object, got "+e.constructor.name+" ("+e+")");this.id=e.id,this.uri=e.uri,this.typeUri=e.typeUri,this.value=e.value,this.children=l.instantiateChildren(e.children)}return V(t,[{key:"getCreationTime",value:function(){return d.getCreationTime(this.id)}},{key:"getModificationTime",value:function(){return d.getModificationTime(this.id)}},{key:"getCreator",value:function(){return d.getCreator(this.id)}},{key:"getModifier",value:function(){return d.getModifier(this.id)}},{key:"getWorkspace",value:function(){return d.getAssignedWorkspace(this.id)}},{key:"getTopicmapTopics",value:function(){return d.getTopicmapTopics(this.id)}},{key:"getRelatedTopicsWithoutChilds",value:function(){return d.getRelatedTopicsWithoutChilds(this.id)}},{key:"fillChildren",value:function(){var t=this;return this.type.compDefs.forEach(function(e){var i=t.children[e.compDefUri],n=void 0;i||(n=new N(e.getChildType().emptyInstance())),e.isOne()?(i?i.fillChildren():i=n,i.fillRelatingAssoc(e)):(i?i.forEach(function(t){t.fillChildren()}):i=[n],i.forEach(function(t){t.fillRelatingAssoc(e)})),n&&w.a.set(t.children,e.compDefUri,i)}),this}},{key:"clone",value:function(){return l.clone(this)}},{key:"typeName",get:function(){return this.type.value}},{key:"backgroundColor",get:function(){return this.type._getBackgroundColor()||"#f5f7fa"}}]),t}(),N=function(t){function e(t){W(this,e);var i=R(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return t.assoc&&(i.assoc=new q(t.assoc)),i}return S(e,B),V(e,[{key:"isType",value:function(){return"dmx.core.topic_type"===this.typeUri||"dmx.core.assoc_type"===this.typeUri}},{key:"isCompDef",value:function(){return!1}},{key:"getRelatedTopics",value:function(t){return d.getTopicRelatedTopics(this.id,t)}},{key:"update",value:function(){return console.log("update",this),d.updateTopic(this)}},{key:"isWritable",value:function(){return I.isTopicWritable(this.id)}},{key:"isTopic",value:function(){return!0}},{key:"isAssoc",value:function(){return!1}},{key:"newViewTopic",value:function(t){return new Q({id:this.id,uri:this.uri,typeUri:this.typeUri,value:this.value,children:{},viewProps:t})}},{key:"asType",value:function(){if("dmx.core.topic_type"===this.typeUri)return C.getTopicType(this.uri);if("dmx.core.assoc_type"===this.typeUri)return C.getAssocType(this.uri);throw Error("not a type: "+this)}},{key:"fillRelatingAssoc",value:function(t){this.assoc?this.assoc.fillChildren():this.assoc=new q(t.getInstanceLevelAssocType().emptyInstance())}},{key:"type",get:function(){return C.getTopicType(this.typeUri)}},{key:"icon",get:function(){return this.type._getIcon()||""}},{key:"iconColor",get:function(){return this.type._getColor()||"hsl(210, 50%, 53%)"}}]),e}(),q=function(t){function e(t){W(this,e);var i=R(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return t.player1&&(i.player1=new L(t.player1)),t.player2&&(i.player2=new L(t.player2)),i}return S(e,B),V(e,[{key:"getPlayer",value:function(t){var e=this.player1.roleTypeUri===t,i=this.player2.roleTypeUri===t;if(e&&i)throw Error("both players of association "+this.id+" have role type "+t);return e?this.player1:i?this.player2:void 0}},{key:"hasPlayer",value:function(t){return this.player1.id===t||this.player2.id===t}},{key:"isType",value:function(){return!1}},{key:"isCompDef",value:function(){return"dmx.core.composition_def"===this.typeUri}},{key:"getRelatedTopics",value:function(t){return d.getAssocRelatedTopics(this.id,t)}},{key:"update",value:function(){return console.log("update",this),d.updateAssoc(this)}},{key:"isWritable",value:function(){return I.isAssocWritable(this.id)}},{key:"isTopic",value:function(){return!1}},{key:"isAssoc",value:function(){return!0}},{key:"newViewAssoc",value:function(t){return new K({id:this.id,uri:this.uri,typeUri:this.typeUri,value:this.value,children:{},player1:this.player1,player2:this.player2,viewProps:t})}},{key:"asCompDef",value:function(){var t=this.getPlayer("dmx.core.parent_type");return C.getTypeById(t.topicId).getCompDefById(this.id)}},{key:"type",get:function(){return C.getAssocType(this.typeUri)}},{key:"color",get:function(){return this.type._getColor()||"hsl(0, 0%, 80%)"}}]),e}(),L=function(){function t(e){if(W(this,t),-1===e.topicId||-1===e.assocId)throw Error("player ID is -1 in "+JSON.stringify(e));this.topicId=e.topicId,this.topicUri=e.topicUri,this.assocId=e.assocId,this.roleTypeUri=e.roleTypeUri}return V(t,[{key:"getRoleType",value:function(){return C.getRoleType(this.roleTypeUri)}},{key:"isTopicPlayer",value:function(){return this.topicId>=0}},{key:"isAssocPlayer",value:function(){return this.assocId}},{key:"fetch",value:function(){if(this.isTopicPlayer())return d.getTopic(this.topicId);if(this.isAssocPlayer())return d.getAssoc(this.assocId);throw Error("ID not set in player "+JSON.stringify(this))}},{key:"roleTypeName",get:function(){return this.getRoleType().value}},{key:"id",get:function(){if(this.isTopicPlayer())return this.topicId;if(this.isAssocPlayer())return this.assocId;throw Error("ID not set in player "+JSON.stringify(this))}}]),t}(),J=function(t){function e(t){W(this,e);var i=R(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.assoc=new q(t.assoc),i}return S(e,N),e}(),X=function(t){function e(t){W(this,e);var i=R(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.dataTypeUri=t.dataTypeUri,i.compDefs=l.instantiateMany(t.compDefs,G),i.viewConfig=l.mapByTypeUri(l.instantiateMany(t.viewConfigTopics,N)),i}return S(e,N),V(e,[{key:"isSimple",value:function(){return["dmx.core.text","dmx.core.html","dmx.core.number","dmx.core.boolean"].includes(this.dataTypeUri)}},{key:"isComposite",value:function(){return!this.isSimple()}},{key:"isValue",value:function(){return"dmx.core.value"===this.dataTypeUri}},{key:"isIdentity",value:function(){return"dmx.core.identity"===this.dataTypeUri}},{key:"getDataType",value:function(){return C.getDataType(this.dataTypeUri)}},{key:"getCompDefById",value:function(t){var e=this.compDefs.filter(function(e){return e.id===t});if(1!==e.length)throw Error('type "'+this.uri+'" has '+e.length+" comp defs with ID "+t);return e[0]}},{key:"getViewConfig",value:function(t){var e=this.viewConfig["dmx.webclient.view_config"];if(e){var i=e.children[t];return i&&i.value}}},{key:"_getColor",value:function(){return this.getViewConfig("dmx.webclient.color")}},{key:"_getBackgroundColor",value:function(){return this.getViewConfig("dmx.webclient.color#dmx.webclient.background_color")}},{key:"emptyInstance",value:function(){var t,e=this;return{id:-1,uri:"",typeUri:this.uri,value:"",children:(t={},e.compDefs.forEach(function(e){var i=e.getChildType().emptyInstance();t[e.compDefUri]=e.isOne()?i:[i]}),t)}}},{key:"toExternalForm",value:function(){var t=JSON.parse(JSON.stringify(this));return t.compDefs.forEach(function(t){t.assocTypeUri=t.typeUri,delete t.typeUri}),console.log("toExternalForm",t),t}}]),e}(),z=function(t){function e(){return W(this,e),R(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return S(e,X),V(e,[{key:"newTopicModel",value:function(t){var e=function e(i){var n=C.getTopicType(i);if(n.isSimple())return{value:t};var o=n.compDefs[0],r=e(o.childTypeUri);return{children:(c={},s=o.compDefUri,a=o.isOne()?r:[r],s in c?Object.defineProperty(c,s,{value:a,enumerable:!0,configurable:!0,writable:!0}):c[s]=a,c)};var c,s,a}(this.uri);return e.typeUri=this.uri,e}},{key:"_getIcon",value:function(){return this.getViewConfig("dmx.webclient.icon")}},{key:"isTopicType",value:function(){return!0}},{key:"isAssocType",value:function(){return!1}},{key:"update",value:function(){return d.updateTopicType(this.toExternalForm())}},{key:"icon",get:function(){return this._getIcon()||""}}]),e}(),F=function(t){function e(){return W(this,e),R(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return S(e,X),V(e,[{key:"isTopicType",value:function(){return!1}},{key:"isAssocType",value:function(){return!0}},{key:"update",value:function(){return d.updateAssocType(this.toExternalForm())}}]),e}(),G=function(t){function e(t){W(this,e);var i=R(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));i.viewConfig=l.mapByTypeUri(l.instantiateMany(t.viewConfigTopics,N)),i.parentTypeUri=i.getPlayer("dmx.core.parent_type").topicUri,i.childTypeUri=i.getPlayer("dmx.core.child_type").topicUri;var n=i.children["dmx.core.assoc_type#dmx.core.custom_assoc_type"];i.customAssocTypeUri=n&&n.uri,i.compDefUri=i.childTypeUri+(i.customAssocTypeUri?"#"+i.customAssocTypeUri:""),i.instanceLevelAssocTypeUri=i.customAssocTypeUri||i._defaultInstanceLevelAssocTypeUri();var o=i.children["dmx.core.cardinality"];if(!o)throw Error("comp def "+i.compDefUri+" has no cardinality child (parent type: "+i.parentTypeUri+")");i.childCardinalityUri=o.uri;var r=i.children["dmx.core.identity_attr"];i.isIdentityAttr=!!r&&r.value;var c=i.children["dmx.core.include_in_label"];return i.includeInLabel=!!c&&c.value,i}return S(e,q),V(e,[{key:"getChildType",value:function(){return C.getTopicType(this.childTypeUri)}},{key:"getInstanceLevelAssocType",value:function(){return C.getAssocType(this.instanceLevelAssocTypeUri)}},{key:"getCustomAssocType",value:function(){return this.customAssocTypeUri&&C.getAssocType(this.customAssocTypeUri)}},{key:"isOne",value:function(){return"dmx.core.one"===this.childCardinalityUri}},{key:"isMany",value:function(){return"dmx.core.many"===this.childCardinalityUri}},{key:"getViewConfig",value:function(t){var e=this._getViewConfig(t);return e&&e.value}},{key:"_getViewConfig",value:function(t){var e=this.viewConfig["dmx.webclient.view_config"];if(e)return e.children[t]}},{key:"_defaultInstanceLevelAssocTypeUri",value:function(){if(!this.isCompDef())throw Error('unexpected association type URI: "'+this.typeUri+'"');return"dmx.core.composition"}},{key:"emptyChildInstance",value:function(){var t=this.getChildType().emptyInstance();return t.assoc=this.getInstanceLevelAssocType().emptyInstance(),new N(t)}}]),e}(),H=function(t){function e(t){W(this,e);var i=R(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t.topic));return i.viewProps=t.viewProps,i._topics=l.mapById(l.instantiateMany(t.topics,Q)),i._assocs=l.mapById(l.instantiateMany(t.assocs,K)),i}return S(e,N),V(e,[{key:"getTopic",value:function(t){var e=this.getTopicIfExists(t);if(!e)throw Error("topic "+t+" not found in topicmap "+this.id);return e}},{key:"getAssoc",value:function(t){var e=this.getAssocIfExists(t);if(!e)throw Error("assoc "+t+" not found in topicmap "+this.id);return e}},{key:"getTopicIfExists",value:function(t){return this._topics[t]}},{key:"getAssocIfExists",value:function(t){return this._assocs[t]}},{key:"hasTopic",value:function(t){return this.getTopicIfExists(t)}},{key:"hasAssoc",value:function(t){return this.getAssocIfExists(t)}},{key:"addTopic",value:function(t){if(!(t instanceof Q))throw Error("addTopic() expects a ViewTopic, got "+t.constructor.name);w.a.set(this._topics,t.id,t)}},{key:"addAssoc",value:function(t){if(!(t instanceof K))throw Error("addAssoc() expects a ViewAssoc, got "+t.constructor.name);w.a.set(this._assocs,t.id,t)}},{key:"revealTopic",value:function(t,e){var i={},n=this.getTopicIfExists(t.id);return n?n.isVisible()||(n.setVisibility(!0),i.type="show",i.viewTopic=n):(n=t.newViewTopic(D({},e?{"dmx.topicmaps.x":e.x,"dmx.topicmaps.y":e.y}:void 0,{"dmx.topicmaps.visibility":!0,"dmx.topicmaps.pinned":!1})),this.addTopic(n),i.type="add",i.viewTopic=n),i}},{key:"revealAssoc",value:function(t){var e={},i=this.getAssocIfExists(t.id);return i?i.isVisible()||(i.setVisibility(!0),e.type="show",e.viewAssoc=i):(i=t.newViewAssoc({"dmx.topicmaps.visibility":!0,"dmx.topicmaps.pinned":!1}),this.addAssoc(i),e.type="add",e.viewAssoc=i),e}},{key:"removeTopic",value:function(t){w.a.delete(this._topics,t)}},{key:"removeAssoc",value:function(t){w.a.delete(this._assocs,t)}},{key:"getAssocsWithPlayer",value:function(t){return this.assocs.filter(function(e){return e.hasPlayer(t)})}},{key:"hideAssocsWithPlayer",value:function(t){var e=this;this.getAssocsWithPlayer(t).forEach(function(t){t.setVisibility(!1),e.hideAssocsWithPlayer(t.id)})}},{key:"removeAssocsWithPlayer",value:function(t){var e=this;this.getAssocsWithPlayer(t).forEach(function(t){e.removeAssoc(t.id),e.removeAssocsWithPlayer(t.id)})}},{key:"getOtherPlayer",value:function(t,e){var i=void 0;if(t.player1.id===e)i=t.player2.id;else{if(t.player2.id!==e)throw Error(e+" is not a player in assoc "+JSON.stringify(t));i=t.player1.id}return this.getObject(i)}},{key:"getObject",value:function(t){var e=this.getTopicIfExists(t)||this.getAssocIfExists(t);if(!e)throw Error("topic/assoc "+t+" not found in topicmap "+this.id);return e}},{key:"getPosition",value:function(t){var e=this.getObject(t);if(e.isTopic())return e.getPosition();var i=this.getPosition(e.player1.id),n=this.getPosition(e.player2.id);return{x:(i.x+n.x)/2,y:(i.y+n.y)/2}}},{key:"setViewport",value:function(t,e){this.viewProps["dmx.topicmaps.pan_x"]=t.x,this.viewProps["dmx.topicmaps.pan_y"]=t.y,this.viewProps["dmx.topicmaps.zoom"]=e}},{key:"topics",get:function(){return Object.values(this._topics)}},{key:"assocs",get:function(){return Object.values(this._assocs)}}]),e}(),Y=function(t){return function(e){function i(){return W(this,i),R(this,(i.__proto__||Object.getPrototypeOf(i)).apply(this,arguments))}return S(i,t),V(i,[{key:"isVisible",value:function(){return this.getViewProp("dmx.topicmaps.visibility")}},{key:"setVisibility",value:function(t){this.setViewProp("dmx.topicmaps.visibility",t),t||this.setPinned(!1)}},{key:"isPinned",value:function(){return this.getViewProp("dmx.topicmaps.pinned")}},{key:"setPinned",value:function(t){this.setViewProp("dmx.topicmaps.pinned",t)}},{key:"getViewProp",value:function(t){return this.viewProps[t]}},{key:"setViewProp",value:function(t,e){w.a.set(this.viewProps,t,e)}}]),i}()},Q=function(t){function e(t){W(this,e);var i=R(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));if(!t.viewProps)throw TypeError('"viewProps" not set in topic passed to ViewTopic constructor; topic='+JSON.stringify(t));return i.viewProps=t.viewProps,i}return S(e,Y(N)),V(e,[{key:"fetchObject",value:function(){return d.getTopic(this.id,!0,!0)}},{key:"getPosition",value:function(){return{x:this.getViewProp("dmx.topicmaps.x"),y:this.getViewProp("dmx.topicmaps.y")}}},{key:"setPosition",value:function(t){this.setViewProp("dmx.topicmaps.x",t.x),this.setViewProp("dmx.topicmaps.y",t.y)}}]),e}(),K=function(t){function e(t){W(this,e);var i=R(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));if(!t.viewProps)throw TypeError('"viewProps" not set in assoc passed to ViewAssoc constructor; assoc='+JSON.stringify(t));return i.viewProps=t.viewProps,i}return S(e,Y(q)),V(e,[{key:"fetchObject",value:function(){return d.getAssoc(this.id,!0,!0)}}]),e}(),Z=function(t){function e(t){W(this,e);var i=R(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t.topic));return i.viewProps=t.viewProps,i.geoCoordTopics=t.geoCoordTopics,i}return S(e,N),V(e,[{key:"removeTopic",value:function(t){}},{key:"removeAssoc",value:function(t){}}]),e}();console.log("[DMX] Client API 2019/08/24");e.default={DMXObject:B,Topic:N,Assoc:q,Player:L,RelatedTopic:J,Type:X,TopicType:z,AssocType:F,Topicmap:H,ViewTopic:Q,ViewAssoc:K,Geomap:Z,restClient:d,typeCache:C,permCache:I,utils:l,init:function(t){return t.onHttpError&&d.setErrorHandler(t.onHttpError),C.init(t.store)}}}])});